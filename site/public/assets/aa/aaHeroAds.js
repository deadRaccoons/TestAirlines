function aaHeroAds(slideshowContainer,source,params){var startTime=new Date().getTime();var self=this,slideshow=slideshowContainer,defaults={fit:1,height:594,width:1100,slideExpr:"div",speed:1000,timeout:8000,pager:"#hero-pager",next:"#hero-next",prev:"#hero-prev",pause:1,hideControls:0,before:function(currSlideElement,nextSlideElement,options,forwardFlag){var nSlide=jQuery(source)[options.nextSlide];if(nSlide.isFlash){if(options.nextSlide!=options.currSlide){self.flashActions(nSlide,"rewind");}}},after:function(currSlideElement,nextSlideElement,options,forwardFlag){var cSlide=jQuery(source)[options.currSlide];if(cSlide.isFlash){self.flashActions(cSlide,"play");}var totalTime=new Date().getTime()-startTime;if(totalTime<300000){self.reportImpression(cSlide);}}},settings=jQuery.extend({},defaults,params);self.init=function(){self.parseSlides();if(jQuery(source).length>1){jQuery(slideshow).find("div:first").fadeIn(1000,function(){jQuery(slideshow).cycle(settings);});if(settings.hideControls===1){self.initControls();}}};self.initControls=function(){var frame=jQuery("#aa-hero-ad-frame");var ctrl=frame.find(".hero-controls");frame.mouseenter(function(){ctrl.fadeIn();}).mouseleave(function(){ctrl.fadeOut();});};self.parseSlides=function(){if(jQuery(source).length>0){jQuery("div",slideshow).remove();jQuery(source).each(function(i,item){slide=jQuery("<div></div>");adLink=jQuery('<a id="heroSlide'+item.index+'"></a>');if(item.isFlash&&jQuery.flash.available){jQuery(adLink).flash({swf:item.flashSrc,height:210,width:529});}else{adLink.append('<img src="'+item.imgSrc+'" alt="'+item.altText+'" />');}adLink.attr("class",item.className);adLink.attr("title",item.altText);if(self.isExternalLink(item.target)){adLink.attr("href",item.target);temp=function(){captureExtClickThru(item.target,item.anchorLocation,item.altText,item.repositoryName,item.repositoryId,item.locale,item.isFlash,item.index);};item.isFlash?adLink.mouseup(temp):adLink.click(temp);}else{adLink.attr("href",item.target+(item.target.indexOf("?")!=-1?"&":"?")+"anchorLocation="+item.anchorLocation+"&reportedTitle="+item.altText+"&reportedPosition="+item.index+"&url="+self.getUrlParam(item.target)+"&_locale="+item.locale+"&repositoryName="+item.repositoryName+"&repositoryId="+item.repositoryId);}if(item.openInNewWin=="Y"){temp=function(){window.open(this.href,"","scrollbars=yes,toolbar=yes,resizable=yes,status=yes,location=no,menubar=no,width=700,height=480,top=1,left=385");return false;};item.isFlash?adLink.mouseup(temp):adLink.click(temp);}else{if(item.isFlash){adLink.mouseup(function(){location.href=this.href;});}}slide.append(adLink);if(item.restrictionsApply=="Y"){rLink='<a href="'+item.target+'&restrictionsAnchor=true#restrictions">'+item.restrictionsLink+"</a>";rSpan=jQuery("<span>"+item.restrictionsText+" "+rLink+"</span>");rSpan.attr("id","aa-hero-faresale-terms");slide.append(rSpan);}slide.appendTo(slideshow);});if(jQuery(source).length>1&&settings.hideControls===0){jQuery("#aa-hero-ad-ctrl").fadeIn();}else{self.reportImpression(jQuery(source)[0]);}}};self.flashActions=function(slide,action){var flashMovie=jQuery("#heroSlide"+slide.index);flashMovie.flash(function(){try{if(action=="play"){this.Play();}if(action=="rewind"){this.Rewind();}}catch(e){}});};self.reportImpression=function(cSlide){jQuery.ajax({type:"POST",url:"/home/ajax/reportImpression",data:JSON.stringify({flash:cSlide.isFlash,reportedLocation:cSlide.anchorLocation,reportedTarget:self.getReportedTarget(cSlide.target),reportedTitle:cSlide.altText,locale:cSlide.locale}),contentType:"application/json",async:true,cache:false,timeout:60000,dataType:"JSON"});};self.getUrlParam=function(name,url){var results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(url);return(results===null)?encodeURIComponent(url):results[1];};self.isExternalLink=function(link){if(link.indexOf("http")===0){if(link.indexOf("www.aa.com")!=1){return true;}}return false;};self.getTargetNoParams=function(url){var symbols=new Array("?",";","#");var targetNoParams=url;var index=-1;for(var i=0;i<symbols.length;++i){index=targetNoParams.indexOf(symbols[i]);if(index!=-1){targetNoParams=targetNoParams.substring(0,targetNoParams.indexOf(symbols[i]));}}return targetNoParams;};self.getReportedTarget=function(url){var fileName=self.getUrlParam("fN",url);if(fileName.length>0){return fileName;}else{return self.getTargetNoParams(url);}};self.init();}jQuery.fn.aaHeroAds=function(source,params){var i=0;for(i;i<this.length;i++){obj=new aaHeroAds(this[i],source,params);}};